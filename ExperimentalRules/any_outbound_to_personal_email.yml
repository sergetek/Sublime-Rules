name: "Any Outbound to Personal Email Address"
description: "Detects any outbound messages (not just forwards) to free or disposable email providers with similar matching criteria."
type: "rule"
severity: "medium"
source: |
  type.outbound
  and any(recipients.to,
          (
            strings.levenshtein(.email.local_part, sender.email.local_part) <= 2
            or strings.ilevenshtein(.display_name, sender.display_name) <= 2
          )
          and (
            .email.domain.root_domain in $free_email_providers
            or .email.domain.root_domain in $disposable_email_providers
          )
  )

detection_methods:
  - "Name similarity detection"
  - "Recipient analysis"
